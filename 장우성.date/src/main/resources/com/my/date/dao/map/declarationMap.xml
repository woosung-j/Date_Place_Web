<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE mapper PUBLIC '-//mybatis.org//DTD Mapper 3.0//EN'
	'http://mybatis.org/dtd/mybatis-3-mapper.dtd'>
<mapper namespace='com.my.date.dao.map.DeclarationMap'>
	<select id='selectDeclarations' resultMap="declarationsMap">
		select d.declare_id, d.place_id, d.user_id, d.content, d.confirm, d.created_at, u.id, p.place_name, details.address
		from declarations d, users u, places p, details
		where d.user_id = u.user_id and d.place_id = p.place_id and d.place_id = details.place_id
		order by created_at desc
	</select>

	<update id="updateConfirm">
		update declarations
		set confirm = #{confirm}
		where declare_id = #{declareId}
	</update>

	<resultMap id="declarationsMap" type="declaration">
		<id property="declareId" column="declare_id"/>
		<result property="placeId" column="place_id"/>
		<result property="userId" column="user_id"/>
		<result property="content" column="content"/>
		<result property="confirm" column="confirm"/>
		<result property="createdAt" column="created_at"/>
		<collection property="user" resultMap="userMap"/>
		<collection property="place" resultMap="placeMap"/>
		<collection property="detail" resultMap="detailMap"/>
	</resultMap>

	<resultMap id="userMap" type="user">
		<result property="id" column="id"/>
	</resultMap>

	<resultMap id="placeMap" type="place">
		<result property="placeName" column="place_name"/>
	</resultMap>

	<resultMap id="detailMap" type="detail">
		<result property="address" column="address"/>
	</resultMap>
</mapper>